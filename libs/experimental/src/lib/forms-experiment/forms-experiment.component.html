<form class="experimental-form" [formGroup]="form" (ngSubmit)="onSubmit()">
  <h4 class="h4 mb16">Информация о верстке</h4>

  <label class="tt-control-label mb16">
    Тип получателя
    <select class="tt-input" formControlName="type">
      <option [value]="ReciverType.PERSON">Физическое лицо</option>
      <option [value]="ReciverType.LEGAL">Юридическое лицо</option>
    </select>
  </label>

  <label class="tt-control-label mb16">
    Имя

    <input
      formControlName="name"
      class="tt-input"
      type="text"
      placeholder="Введите имя"
      [class.error]="form.controls.name.invalid && (form.controls.name.touched || form.controls.name.dirty)"
    >
  </label>

  @if (form.controls.name.touched && form.controls.name.hasError('required')) {
    <small class="tt-input-error">Это поле обязательно!</small>
  }

  @if (form.controls.type.value === ReciverType.LEGAL) {
    <label class="tt-control-label mb16">
      ИНН
      <input
        formControlName="inn"
        class="tt-input"
        type="text"
        placeholder="Введите ИНН"
        [class.error]="form.controls.inn.invalid && (form.controls.inn.touched || form.controls.inn.dirty)"
      >
    </label>

  } @else {
    <label class="tt-control-label mb16">
      Фамилия
      <input
        formControlName="lastName"
        class="tt-input"
        type="text"
        placeholder="Введите фамилию"
        [class.error]="form.controls.lastName.invalid && (form.controls.lastName.touched || form.controls.lastName.dirty)"
      >
    </label>
  }

  @if (form.controls.inn.touched && form.controls.inn.hasError('required') ||
  form.controls.lastName.touched && form.controls.lastName.hasError('required')) {
    <small class="tt-input-error">Это поле обязательно!</small>
  }

  <label class="tt-control-label mb16">
    Дата начала
    <input
      type="date"
      formControlName="dateBegin"
      class="tt-input"
      [class.error]="
      (form.controls.dateBegin.invalid && (form.controls.dateBegin.touched || form.controls.dateBegin.dirty)) ||
      (form.hasError('dateRange') && form.controls.dateBegin.touched && form.controls.dateEnd.touched)
    "
    >
  </label>

  <label class="tt-control-label mb16">
    Дата окончания
    <input
      type="date"
      formControlName="dateEnd"
      class="tt-input"
      [class.error]="
      (form.controls.dateEnd.invalid && (form.controls.dateEnd.touched || form.controls.dateEnd.dirty)) ||
      (form.hasError('dateRange') && form.controls.dateBegin.touched && form.controls.dateEnd.touched)
    "
    >
  </label>

  @if ((form.controls.dateBegin.touched && form.controls.dateBegin.hasError('required')) ||
  (form.controls.dateEnd.touched && form.controls.dateEnd.hasError('required'))) {
    <small class="tt-input-error">Обе даты обязательны!</small>
  }

  @if (form.hasError('dateRange') && form.controls.dateBegin.touched && form.controls.dateEnd.touched) {
    <small class="tt-input-error">Дата начала не может быть позже даты окончания</small>
  }


  <div>
    <div style="display:flex; justify-content: space-between">
      <h4 class="h4 mb16">Адрес доставки</h4>
      <button class="btn" style="width: 50px" (click)="addAddress()">+</button>
    </div>

    @for (group of form.controls.addresses.controls; track group; let i = $index) {
      <div class="form-grid" [formGroup]="group">
        <label class="tt-control-label mb16">
          Город
          <input
            formControlName="city"
            class="tt-input"
            type="text"
            placeholder="Город"
          >
        </label>

        <label class="tt-control-label mb16">
          Улица
          <input
            formControlName="street"
            class="tt-input"
            type="text"
            placeholder="Улица"
          >
        </label>

        <label class="tt-control-label mb16">
          Дом
          <input
            formControlName="building"
            class="tt-input"
            type="text"
            placeholder="Дом"
          >
        </label>

        <label class="tt-control-label mb16">
          Квартира
          <input
            formControlName="apartment"
            class="tt-input"
            type="text"
            placeholder="Квартира"
          >
        </label>

        <button
          class="btn"
          style="grid-column-start: 1;
          grid-column-end: 3"
          (click)="deleteAddress(i)"
        >Удалить
        </button>
      </div>

    }
  </div>

  <div [formGroup]="form.controls.feature">
    <h4 class="h4 mb16">Дополнительно</h4>

    <div style="display: grid; gap: 16px;">
      @for (control of form.controls.feature.controls | keyvalue: sort; track control; let i = $index) {
        <label>
          {{ features[i].label }}
          <input type="checkbox" [formControlName]="control.key">
        </label>
      }
    </div>
  </div>


  <button
    class="btn btn--shadow mt20"
    type="submit"
  >Подтвердить
  </button>
</form>
